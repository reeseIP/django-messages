{% extends 'messagelocus/base.html' %}

{% block content %}
	<h1>{{ JobId }}</h1>
	<br>
	<div id= 'jobview-div-header'>
		<div id='jobview-div-job-info'>
			<h4 class='jobview-header'>Job Information</h4>
			<ul>
			{% for key, value in job_data.items %}
				{% if key == 'id' or key == 'active' %}
			    <li id='jobview-jobinfo-{{ key }}' style='display: none;'>
			    	<label class='key'>{{ key }}: </label><label class='value'>{{ value }}</label>
			    </li>
				{% else %}
			    <li id='jobview-jobinfo-{{ key }}'>
			    	<label class='key'>{{ key }}: </label><label class='value'>{{ value }}</label>
			    </li>
			    {% endif %}
			{% endfor %}
		</ul>
		</div>
		<br>
		<div id='jobview-div-job-events'>
			<h4>Job Events</h4>
			<!-- comment line -->
			<form method='post' id='form-send-event'>
				{% csrf_token %}
				<!--<div class="dropdown">
					<span class="dropbtnsta">
					  	<button type='button' id='select-event'>--- Select Event --- &#11206;</button>
					</span>-->
	                  <div class="nav-item dropdown">
	                  <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" id="jobview-a-dropdown-event">Select Event</a>
	                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id='jobview-ul-dropdown-event-options'>
	                    <li><a class="dropdown-item" href="#" name='accept'>Accept</a></li>
	                    <li><a class="dropdown-item" href="#" name='reject'>Reject</a></li>
	                    <li><a class="dropdown-item" href="#" name='induct'>Induct</a></li>
	                    <li><a class="dropdown-item" href="#" name='complete'>Complete</a></li>
	                    <li><a class="dropdown-item" href="#" name='cancelcomplete'>Cancel Complete</a></li>
	                    <li><a class="dropdown-item" href="#" name='cancelreject'>Cancel Reject</a></li>
	                    <li><a class="dropdown-item" href="#" name='updatecomplete'>Update Complete</a></li>
	                    <li><a class="dropdown-item" href="#" name='updatereject'>Update Reject</a></li>
	                    {% if job_type == 'OrderJob' %}
					  		<li><a class="dropdown-item" href="#" name='print'>Print</a></li>
					  	{% endif %}
	                    
	                  </ul>
	                </div>
					<!--<div class="dropdown-status" id='div-dropdown-status'>
					  	<button type='button' class='option' name='accept'>Accept</button>
					  	<button type='button' class='option' name='reject'>Reject</button>
					  	<button type='button' class='option' name='induct'>Induct</button>
					  	<button type='button' class='option' name='complete'>Complete</button>
					  	<button type='button' class='option' name='cancelcomplete'>Cancel Complete</button>
					  	<button type='button' class='option' name='cancelreject'>Cancel Reject</button>
					  	<button type='button' class='option' name='updatecomplete'>Update Complete</button>
					  	<button type='button' class='option' name='updatereject'>Update Reject</button>
					  	{% if job_type == 'OrderJob' %}
					  		<button type='button' class='option' name='print'>Print</button>
					  	{% endif %}
					</div>
				</div>-->
				<button class='send-request' type='submit' name='btn-send-event' id='btn-send-event'>Send</button>
				<div id="div-induct-robot">
					<label id='lbl-induct-robot'>Robot: </label><input id='inp-induct-robot'type='entry' name='robot' value='{{ job_data.JobRobot }}'>
				</div>
			</form>
			<br>
		</div>
	</div>

<!-- Job Task Table -->
<!-------------------------------------------------------------------->
<h4 class='jobview-header'>Job Tasks</h4>
<table class="table table-hover" id='jobview-table-job-tasks'>
          <thead>
          <tr>
            <th scope="col">JobTaskId</th>
          </tr>
          </thead>
          <tbody>
			{% for form in formset %}
				<tr>
				 	<td><a type='button' class='btn-task-data'>{{ form.JobTaskId.value }}</a></td>
				</tr>
			{% endfor %}
          </tbody>
        </table>
	<br>

<!-- Job Event Table -->
<!-------------------------------------------------------------------->

<h4 class='jobview-header'>Event Log</h4>
<table class="table table-hover" id='jobview-table-job-events'>
          <thead>
          <tr>
            <th scope="col">Event Type</th>
            <th scope="col">Date</th>
            <th scope="col">Event Info</th>
          </tr>
          </thead>
          <tbody>
			{% for event in events %}
				<tr>
					<td>{{ event.EventType }}</td>
					<td>{{ event.JobDate }}</td>
					<td>{{ event.EventInfo }}</td>
				</tr>
			{% endfor %}
          </tbody>
        </table>
	<br>

    <a href="/messagelocus/{{ JobId }}/closejob/">Close Job</a>

	{{ formset.management_form }}
	{% for form in formset %}
    <!-- Modal: Target System Credentials -->
    <div class="modal fade taskData" id="{{ form.JobTaskId.value }}" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
       		<form class='taskData' method="post" action='task/'>
          <!--<form class="form" role="form" action='/messagelocus/set_target_user/' method="post">-->
	            {% csrf_token %}
	            <div class="modal-header">
	             	<h4 class="modal-title">Task Data</h4>
	            </div>
	            <div class="modal-body">
	            	<div class='task-data'>
						{% for field in form %}
							{% if field.name == 'SerialNo' %}
							{% else %}
				        	<span>
				        		<label class='task-data' for="{{ field.auto_id }}">{{ field.name }}:</label> {{ field }}
				        	</span>
				        	{% endif %}
				    	{% endfor %}
			    	</div>
			    	<div class='task-sn-capture' style='display: none;'>

			    	</div>
	            </div>
	            <div class="modal-footer">
	            	<button class="btn btn-success submit taskSend" type="submit">Send Task</button>
	            	<button type="button" class="btn btn-default close" data-dismiss="modal">Close</button>
	            </div>
        	</form>
        </div>
      </div>
    </div>
    {% endfor %}

{% endblock %}